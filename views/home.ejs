<link rel="stylesheet" type="text/css" href="/css/home.css">
<h1 id="website-header">Codeial Home Page: <%= title %></h1>

<main id="main-content">
    <section id="feed-posts">
        <h4>Posts</h4>
    
        <%  if(locals.user) { %> 
                <form action="/posts/create-post" method="POST">
                <textarea name="content" cols="30" rows="4" placeholder="Type Here"></textarea>
                <button type="submit">Submit Post</button>
                </form>         
                <br>
             <% }
        %>
        
    
        <div id="posts-feed-container">
            <%  for(let i of posts) 
                {%>
                    <div class="single-post-container">
                        <div class="item-delete-container">
                            <div class="content"><%= i.content %></div>
                            <%  
                                if((locals.user) && (i.user._id.toString() == locals.user._id.toString())) {
                                %>
                                    <button type="submit">Delete Post</button>
                                <%}
                            %>
                        </div>
                        
                        <div><%= i.user.name %></div>
                        <div class="date-created"><%= i.createdAt %></div>

                        <% 
                            if(locals.user) 
                            {%> 
                                <div>
                                    <form method="POST" action="/comments/post-comment/?post=<%= i._id %>&user=<%= locals.user._id %>">
                                        <textarea name="content" cols="30" rows="1"></textarea>
                                        <button type="submit">Post Comment</button>
                                    </form>
                                </div>    
                            <%}
                        %>

                        <div class="comments-container">
                        <% 
                            for(let j of i.comments) 
                            {%> <div class="single-comment-container">
                                    <div class="item-delete-container">
                                        <div class="content"><%=j.content%></div>
                                        <%
                                            if((locals.user) && (j.user._id.toString() == locals.user._id.toString())) {%> 
                                                <button type="submit">Delete Comment</button> 
                                            <%}
                                        %>
                                    </div>
                                    
                                    <div><%=j.user.name%></div>
                                    <div class="date-created"><%=j.createdAt%></div>
                                </div>
                            <%} 
                        %>
                        </div>
                    </div>

                    
                    
                <%} 
            %>
        </div>
    </section>
</main>


<script src="/js/home.js"></script>